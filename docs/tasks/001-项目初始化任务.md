# 任务 001: 项目初始化与脚手架搭建

## 一、任务概述

**任务名称**：项目初始化与脚手架搭建
**优先级**：P0（最高优先级）
**预估工作量**：2-3小时
**任务类型**：基础建设

## 二、任务目标

搭建基于 **Tauri + Vue 3 + TypeScript + Vuetify** 的桌面应用开发环境，完成项目基础架构，为后续开发奠定基础。

## 三、技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | >= 18.0.0 | 运行时环境 |
| npm/pnpm | >= 8.0.0 | 包管理器 |
| Tauri | >= 1.5.0 | 桌面应用框架 |
| Vue 3 | >= 3.3.0 | 前端框架 |
| TypeScript | >= 5.0.0 | 类型系统 |
| Vite | >= 4.0.0 | 构建工具 |
| Vuetify | >= 3.3.0 | UI 组件库 |
| Pinia | >= 2.1.0 | 状态管理 |
| Vue Router | >= 4.2.0 | 路由管理 |

## 四、实施步骤

### 步骤 1: 环境准备

#### 1.1 检查 Node.js 环境
```bash
# 检查 Node.js 版本（需要 >= 18.0.0）
node --version

# 检查 npm 版本
npm --version

# 如果版本不符合，请升级 Node.js
```

#### 1.2 安装 Rust 工具链（Tauri 依赖）
```bash
# Windows: 下载并安装 Rust
# 访问: https://www.rust-lang.org/tools/install

# 验证安装
rustc --version
cargo --version
```

#### 1.3 安装 Tauri CLI
```bash
# 全局安装 Tauri CLI
npm install -g @tauri-apps/cli

# 验证安装
tauri --version
```

### 步骤 2: 创建 Tauri + Vue 项目

#### 2.1 使用 Tauri 脚手架创建项目
```bash
# 在项目根目录执行
npm create tauri-app@latest

# 交互式选择：
# - Project name: deskmeta-management
# - Frontend framework: Vue
# - Use TypeScript: Yes
# - Package manager: npm (或 pnpm)
# - UI template: Vuetify
# - Window title: 智能换座位系统
```

#### 2.2 项目结构验证
创建完成后，应生成以下基础结构：
```
deskmeta-management/
├── src/                    # Vue 前端代码
│   ├── src/
│   │   ├── App.vue
│   │   └── main.ts
│   └── package.json
├── src-tauri/              # Tauri 后端代码
│   ├── src/
│   │   └── main.rs
│   ├── Cargo.toml
│   └── tauri.conf.json
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

### 步骤 3: 安装项目依赖

#### 3.1 安装前端依赖
```bash
# 进入项目目录
cd deskmeta-management

# 安装核心依赖
npm install vue@latest
npm install vue-router@latest
npm install pinia@latest

# 安装 UI 组件库
npm install vuetify@latest
npm install @mdi/font       # Material Design Icons

# 安装工具库
npm install gsap            # 动画库
npm install jspdf           # PDF 生成
npm install html2canvas     # HTML 转 Canvas

# 安装开发依赖
npm install -D @types/node
npm install -D sass         # Vuetify 需要 Sass
```

#### 3.2 配置 Vuetify

创建 `src/vuetify.ts`：
```typescript
// plugins/vuetify.ts
import { createVuetify } from 'vuetify'
import * as components from 'vuetify/components'
import * as directives from 'vuetify/directives'

export default createVuetify({
  components,
  directives,
  theme: {
    defaultTheme: 'light'
  }
})
```

#### 3.3 配置 Pinia

创建 `src/stores/index.ts`：
```typescript
// stores/index.ts
import { createPinia } from 'pinia'

const pinia = createPinia()

export default pinia
```

#### 3.4 配置 Vue Router

创建 `src/router/index.ts`：
```typescript
// router/index.ts
import { createRouter, createWebHashHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Home',
    component: () => import('../views/Home.vue')
  }
]

const router = createRouter({
  history: createWebHashHistory(),
  routes
})

export default router
```

### 步骤 4: 配置 TypeScript

#### 4.1 更新 `tsconfig.json`
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

#### 4.2 创建 `tsconfig.node.json`
```json
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}
```

### 步骤 5: 配置 Vite

#### 5.1 更新 `vite.config.ts`
```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  clearScreen: false,
  server: {
    port: 1420,
    strictPort: true,
    watch: {
      ignored: ['**/src-tauri/**']
    }
  }
})
```

### 步骤 6: 配置 Tauri

#### 6.1 更新 `src-tauri/tauri.conf.json`
```json
{
  "$schema": "../node_modules/@tauri-apps/cli/schema.json",
  "build": {
    "beforeBuildCommand": "npm run build",
    "beforeDevCommand": "npm run dev",
    "devPath": "http://localhost:1420",
    "distDir": "../dist"
  },
  "package": {
    "productName": "智能换座位系统",
    "version": "0.1.0"
  },
  "tauri": {
    "allowlist": {
      "all": false,
      "shell": {
        "all": false,
        "open": true
      },
      "fs": {
        "all": false,
        "readFile": true,
        "writeFile": true,
        "readDir": true,
        "createDir": true,
        "removeFile": true,
        "path": true
      },
      "dialog": {
        "all": false,
        "open": true,
        "save": true
      }
    },
    "bundle": {
      "active": true,
      "targets": "all",
      "identifier": "com.deskmeta.seating",
      "icon": [
        "icons/32x32.png",
        "icons/128x128.png",
        "icons/128x128@2x.png",
        "icons/icon.icns",
        "icons/icon.ico"
      ]
    },
    "security": {
      "csp": null
    },
    "updater": {
      "active": false
    },
    "windows": [
      {
        "fullscreen": false,
        "resizable": true,
        "title": "智能换座位系统",
        "width": 1200,
        "height": 800,
        "minWidth": 1024,
        "minHeight": 768
      }
    ]
  }
}
```

### 步骤 7: 创建项目目录结构

```bash
# 创建核心目录
mkdir -p src/core
mkdir -p src/ui/components
mkdir -p src/ui/views
mkdir -p src/stores
mkdir -p src/repository
mkdir -p src/database/migrations
mkdir -p src/database/seeds
mkdir -p src/types
mkdir -p src/utils
mkdir -p docs/tasks

# 创建子目录
mkdir -p src/ui/components/layout-designer
mkdir -p src/ui/components/student-list
mkdir -p src/ui/components/fill-controls
mkdir -p src/ui/components/animation-player

# 验证目录结构
tree src -L 3
```

### 步骤 8: 配置开发环境

#### 8.1 创建 `.env` 文件
```bash
# .env
VITE_APP_TITLE=智能换座位系统
VITE_APP_VERSION=0.1.0
```

#### 8.2 创建 `.gitignore`
```
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Tauri
src-tauri/target
```

#### 8.3 配置 ESLint（可选）
```bash
# 安装 ESLint
npm install -D eslint
npm install -D @typescript-eslint/parser
npm install -D @typescript-eslint/eslint-plugin
npm install -D eslint-plugin-vue

# 创建 .eslintrc.cjs
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
  },
  extends: [
    'plugin:vue/vue3-essential',
    'eslint:recommended',
    '@vue/typescript/recommended'
  ],
  parserOptions: {
    ecmaVersion: 2020
  }
}
```

### 步骤 9: 创建基础文件

#### 9.1 更新 `src/main.ts`
```typescript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import pinia from './stores'
import vuetify from './plugins/vuetify'

// 注册 Vuetify 样式
import 'vuetify/styles'
import '@mdi/font/css/materialdesignicons.css'

const app = createApp(App)

app.use(router)
app.use(pinia)
app.use(vuetify)

app.mount('#app')
```

#### 9.2 更新 `src/App.vue`
```vue
<template>
  <v-app>
    <v-main>
      <router-view />
    </v-main>
  </v-app>
</template>

<script setup lang="ts">
// App 主组件
</script>

<style>
#app {
  width: 100%;
  height: 100%;
}
</style>
```

#### 9.3 创建首页 `src/ui/views/Home.vue`
```vue
<template>
  <v-container fluid>
    <v-row>
      <v-col cols="12">
        <h1>智能换座位系统</h1>
        <p>欢迎使用智能换座位系统！</p>
      </v-col>
    </v-row>
  </v-container>
</template>

<script setup lang="ts">
// 首页组件
</script>
```

### 步骤 10: 开发环境验证

#### 10.1 启动开发服务器
```bash
# 启动 Tauri 开发环境
npm run tauri dev

# 应该自动打开桌面应用窗口
# 窗口标题: 智能换座位系统
# 窗口大小: 1200x800
```

#### 10.2 验证功能清单
- [ ] 应用窗口正常打开
- [ ] 显示"智能换座位系统"标题
- [ ] 控制台无报错
- [ ] 热更新正常工作（修改代码后自动刷新）
- [ ] Vuetify 组件正常渲染
- [ ] TypeScript 类型检查正常

#### 10.3 测试构建
```bash
# 测试生产构建
npm run build

# 应该生成 dist 目录
# 检查 dist 目录是否包含打包后的文件
ls dist
```

## 五、验收标准

### 必须满足（Must Have）
- [x] 项目能够正常启动（`npm run tauri dev`）
- [x] TypeScript 配置正确，无类型错误
- [x] Vuetify 组件库正常工作
- [x] 项目目录结构符合架构设计
- [x] 开发环境热更新正常

### 应该满足（Should Have）
- [x] ESLint 配置完成（如果启用）
- [x] Git 仓库初始化
- [x] README.md 文档完善
- [x] 环境变量配置正确

### 可以满足（Nice to Have）
- [ ] VSCode 配置文件（`.vscode/settings.json`）
- [ ] 代码格式化工具（Prettier）
- [ ] Git Hooks（Husky）

## 六、依赖关系

**前置任务**：无
**后续任务**：
- [任务 002: 数据库设计与实现](./002-数据库设计任务.md)
- [任务 003: 核心类型定义](./003-核心类型定义任务.md)

## 七、风险与注意事项

### 7.1 常见问题

**问题 1: Rust 工具链安装失败**
- 解决：访问 [Rust 官网](https://www.rust-lang.org/tools/install) 下载安装包

**问题 2: Vite 启动端口冲突**
- 解决：修改 `vite.config.ts` 中的 `server.port`

**问题 3: Vuetify 样式不生效**
- 解决：确保在 `main.ts` 中导入了 `'vuetify/styles'`

### 7.2 注意事项

1. **Node.js 版本**：确保使用 Node.js >= 18.0.0
2. **包管理器**：建议使用 npm 或 pnpm，避免混用
3. **系统权限**：Windows 可能需要管理员权限运行某些命令
4. **网络问题**：如果下载依赖慢，可配置 npm 镜像源

## 八、参考文档

- [Tauri 官方文档](https://tauri.app/v1/guides/)
- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Vuetify 3 文档](https://vuetifyjs.com/)
- [Pinia 文档](https://pinia.vuejs.org/)
- [TypeScript 文档](https://www.typescriptlang.org/)

## 九、附录

### 9.1 package.json 脚本命令
```json
{
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "preview": "vite preview",
    "tauri": "tauri",
    "tauri:dev": "tauri dev",
    "tauri:build": "tauri build",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix"
  }
}
```

### 9.2 推荐的 VSCode 插件
```json
{
  "recommendations": [
    "vue.volar",
    "vue.vscode-typescript-vue-plugin",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "tauri-apps.tauri-vscode",
    "rust-lang.rust-analyzer"
  ]
}
```

---

**任务负责人**：待分配
**创建日期**：2025-12-27
**预计完成日期**：待定
**任务状态**：待开始
